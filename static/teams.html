<!doctype html>
<html><head><meta charset="utf-8"><title>Teams</title>
<link rel="stylesheet" href="/static/css/styles.css"></head>
<body>
<div id="nav"></div>
<main>
  <h2>Create Team (Commissioner)</h2>
  <div class="card">
    <label>League:</label>
    <select id="leagueSel"></select>
    <input id="tname" placeholder="team name">
    <button id="tcreate">Create</button>
    <pre id="tout"></pre>
  </div>

  <div class="card">
    <h3>Teams in League</h3>
    <button id="loadTeams">Load</button>
    <table><thead><tr><th>ID</th><th>Name</th></tr></thead><tbody id="ttab"></tbody></table>
  </div>
</main>
<script>fetch('/static/_nav.html').then(r=>r.text()).then(h=>{document.getElementById('nav').innerHTML=h});</script>
<script src="/static/js/api.js"></script>
<script>
async function loadMyLeagues(){
  const res = await fetch('/api/league');
  if(res.status!==200){ document.getElementById('tout').textContent = await res.text(); return; }
  const data = await res.json();
  const sel = document.getElementById('leagueSel'); sel.innerHTML='';
  data.forEach(l=>{
    const opt=document.createElement('option');
    opt.value=l.league_id; opt.textContent = `${l.name} (${l.season_year}) - ${l.role}`;
    sel.appendChild(opt);
  });
}
async function loadTeams(){
  const league_id = document.getElementById('leagueSel').value;
  const r = await fetch('/api/teams?league_id='+encodeURIComponent(league_id));
  const data = await r.json();
  const tb = document.getElementById('ttab'); tb.innerHTML='';
  data.forEach(t=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${t.team_id}</td><td>${t.team_name}</td>`;
    tb.appendChild(tr);
  });
}
document.getElementById('tcreate').onclick = async ()=>{
  const league_id = document.getElementById('leagueSel').value, team_name = document.getElementById('tname').value;
  try{ const r=await API.post('/api/teams',{league_id,team_name}); tout.textContent=JSON.stringify(r,null,2); loadTeams(); }
  catch(e){ tout.textContent=e.message; }
};
document.getElementById('loadTeams').onclick = loadTeams;
loadMyLeagues();
</script>
</body></html>
